# Heat Backend

A digital implementation of the **Heat: Pedal to the Metal** racing board game. This backend provides the game engine and API for managing game state, player actions, and turn-based racing mechanics.

## Tech Stack

- **Runtime:** Cloudflare Workers (serverless edge computing)
- **Framework:** [Hono](https://hono.dev/) (lightweight TypeScript web framework)
- **Language:** TypeScript (strict mode)
- **Testing:** Vitest
- **Linting:** Biome

## Getting Started

### Prerequisites

- Node.js 18+
- pnpm (recommended) or npm

### Installation

```bash
pnpm install
```

### Development

```bash
pnpm run dev
```

### Deployment

```bash
pnpm run deploy
```

## Project Structure

```
src/
├── index.ts              # Hono server entry point
└── engine/
    ├── game-engine.ts    # Core game state & turn management
    ├── player.ts         # Player class & card mechanics
    └── *.test.ts         # Test files
```

## Game Mechanics

### Cards

| Type | Description |
|------|-------------|
| **Speed** | Values 1-4, used for movement |
| **Heat** | Generated by the engine, costs of aggressive driving |
| **Stress** | Added based on map difficulty |
| **Upgrade** | Special cards (values 0 and 5) |

### Turn Phases

1. **Shift** - Select a new gear (1-4)
2. **PlayCards** - Play cards from hand equal to current gear
3. **Move** - Move based on played card values
4. **DiscardAndReplenish** - Discard cards and refill hand to 7

### Gear & Shifting

- Gear range: 1-4
- Shift by 1: Free
- Shift by 2: Costs 1 heat card from engine
- Cannot shift more than 2 gears at once

### Starting Setup (USA Map)

- **Hand:** 7 cards
- **Deck:** 12 speed cards, 2 upgrade cards, 1 heat card, 3 stress cards
- **Engine:** 6 heat cards

## Development

### Commands

| Command | Description |
|---------|-------------|
| `pnpm run dev` | Start local development server |
| `pnpm run test` | Run test suite |
| `pnpm run lint` | Run Biome linter with auto-fix |
| `pnpm run cf-typegen` | Generate Cloudflare Worker types |
| `pnpm run deploy` | Deploy to Cloudflare Workers |

### Cloudflare Bindings

When using Cloudflare bindings, pass them as generics:

```ts
const app = new Hono<{ Bindings: CloudflareBindings }>()
```

## Testing

Tests are written with Vitest and cover:

- Player mechanics (draw, shift, play cards, discard)
- Game state management and phase transitions
- Input validation and error handling

```bash
pnpm run test
```

## Todo

- [ ] Track representation (spaces, corners, sectors)
- [ ] Corner speed limits and heat penalties
- [ ] Stress card resolution (draw from deck during movement)
- [ ] Slipstream/drafting mechanics
- [ ] Win condition and lap tracking
- [ ] Turn order based on track position
- [ ] REST API endpoints
- [ ] Game persistence

## License

MIT
